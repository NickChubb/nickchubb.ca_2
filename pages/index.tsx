import Head from 'next/head'
import styled from 'styled-components'
import NavBar from '../src/components/nav/NavBar'
import React, { useEffect, useState } from 'react'
import Section from '../src/components/shared/Section'
import { sections } from '../src/components/body/sections'
import { breakpoints } from '../src/components/shared/styles'
import { useRouter } from 'next/router'
import { find, pathOr, propEq } from 'ramda'
import Scroller from '../src/components/shared/technologies/scroller'

const Container = styled.div<{
  backgroundColor?: string
  textColor?: string
  isMobile?: boolean
}>`
  width: 100vw;
  height: 100%;
  transition: background-color 0.5s, color 0.25s;

  @media only screen and (min-width: ${breakpoints.mobile}) {
    ${(props) =>
      props.backgroundColor &&
      `
      background-color: ${props.backgroundColor};
    `}
    ${(props) =>
      props.textColor &&
      `
      color: ${props.textColor};
    `}
  }
`

const AppWrapper = styled.div`
  min-height: 100%;
  max-width: 75%;
  margin: 0 auto;
  display: flex;
  flex-direction: row;

  @media only screen and (max-width: ${breakpoints.mobile}) {
    max-width: 100%;
  }
`

const MainWrapper = styled.main`
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  gap: 16px;

  @media only screen and (max-width: ${breakpoints.mobile}) {
    padding: 0 2rem;
  }
`

const Home = () => {
  const { asPath } = useRouter()
  const currentSection = asPath.substring(2)
  const [section, setSection] = useState(currentSection ?? 'bio')
  const [backgroundColor, setBackgroundColor] = useState('#111111')
  const [textColor, setTextColor] = useState('white')

  useEffect(() => {
    // get the backgroundColor from sections data or return normal
    setBackgroundColor(
      pathOr(
        '#111111',
        ['backgroundColor'],
        find(propEq('title', section), sections)
      )
    )
    setTextColor(
      pathOr('white', ['textColor'], find(propEq('title', section), sections))
    )
  }, [section])

  const renderSections = () => {
    return sections.map((section, key) => {
      return (
        <Section
          key={key}
          //@ts-ignore
          Component={section.Content}
          title={section.title}
          setSection={setSection}
          center={section.center ?? false}
          showTitle={section.showTitle ?? true}
        />
      )
    })
  }

  return (
    <Container backgroundColor={backgroundColor} textColor={textColor}>
      <Head>
        <title>Nick Chubb</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <AppWrapper>
        <NavBar section={section} setSection={setSection} />
        <MainWrapper id="main">{renderSections()}</MainWrapper>
      </AppWrapper>
      <Scroller />
    </Container>
  )
}

export default Home
